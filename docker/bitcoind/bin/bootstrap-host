#!/bin/bash

# create the local dir where the repo goes
mkdir -p /opt/bitcoin-flow/
cd /opt/bitcoin-flow/

# grab repo
git clone git@github.com:drausin/bitcoin-flow.git

# get secure conf from S3
if aws s3 test -e "${S3_CONF_FILEPATH}"; then
    aws s3 cp "${S3_CONF_FILEPATH}" "${ROOT_DIR}/conf/bitcoind.secure.properties"
else
    echo "secure configuration file not found in ${S3_CONF_FILEPATH}"
    exit 2
fi

# sync blockchain from S3 to local data volumne
${ROOT_DIR}/bin/restore

# start the full node
${ROOT_DIR}/bin/run-node full


